<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="../../resrc/images/icons/favicon.webp" type="image/x-icon">
    <link rel="stylesheet" href="../styles/common.css">
    <link rel="stylesheet" href="../styles/authentication.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <title>Malang | Recruitments</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        #recruitments {
            overflow-y: hidden;
            margin: 10px;
        }
        #templateForm p {
            font-size: 14px;
            text-align: left;
            color: #9e9e9e;
            margin-bottom: 10px;
        }

        .form-step {
            flex-direction: column;
            justify-content: space-between;

            display: none;
            opacity: 0;
            transition: opacity 0.4s ease-in-out, visibility 0.4s ease-in-out;
        }

        .form-step.active {
            min-height: calc(100vh - 220px);
            display: flex;
            opacity: 1;
        }

        #checks {
            width: calc(100% - 20px);
            font-size: 14px;
            padding: 10px;
            color: #9e9e9e;
            border: 1px solid #383838;
            border-radius: 10px;
            background-color: #1a1a1aa1;
            margin: 10px auto;
        }

        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 10px 0;
        }

        .checkbox-group input[type="checkbox"] {
            display: none;
            /* hide default checkbox */
        }

        .checkbox-group label {
            display: inline-block;
            padding: 5px 10px;
            border: 1px solid #383838;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            user-select: none;
        }

        /* Checked state */
        .checkbox-group input[type="checkbox"]:checked+label {
            background-color: rgba(255, 217, 0, 0.096);
            color: gold;
            border-color: rgba(255, 217, 0, 0.575);
        }


        /* Hidden text input */
        .other-input {
            max-height: 0;
            opacity: 0;
            width: calc(100% - 22px);
            transform: translateY(-10px);
            transition: all 0.3s ease;
        }

        .other-input input {
            margin-top: 7px;
            width: 100%;
            outline: none;
            transition: box-shadow 0.3s ease;
        }

        /* Show animation when "Other" is checked */
        #Other:checked~.other-input {
            max-height: 70px;
            opacity: 1;
            transform: translateY(0);
        }

        select {
            color: grey;
            margin-bottom: 10px;
            padding: 9px;
        }

        option {
            color: grey;
            background-color: black;
            font-size: 15px;
        }

        .btn-group {
            display: flex;
            gap: 10px;
        }
    </style>
</head>

<body>
    <section id="recruitments">
        <canvas id="gradientCanvas"></canvas>
        <form id="templateForm" onsubmit="handleButtonAction('request', 'Requesting' , 'Requested' , () => handleFormSubmit(event))">
            <h3>Feature Request</h3>

            <!--Step 1-->
            <div class="form-step active" id="step1">
                <div class="inputs">
                    <input type="text" id="name" name="name" placeholder="Full Name *" required />
                    <input type="text" id="email" name="email" placeholder="Email ID *" required />
                    <input type="text" id="phone" name="phone" placeholder="Phone Number *" required />
                    <select id="position" name="position" required>
                        <option value="" disabled selected>Position *</option>
                        <option value="Alumni">Malang Alumni</option>
                        <option value="CoreMember">Core Member</option>
                        <option value="Member">Member</option>
                        <option value="Other">Other</option>
                    </select>

                </div>
                <div class="btn-group">
                    <span></span>
                    <button type="button" onclick="nextStep(1)" class="long-btn">Next</button>
                </div>
            </div>

        
            <div class="form-step" id="step2">
                <div class="inputs">
                    <div id="checks">
                        <p>Request Type? *</p>
                        <div class="checkbox-group">
                            <input type="checkbox" id="bug" name="type" value="bug"><label for="bug">Report a Bug</label>
                            <input type="checkbox" id="info" name="type" value="info"><label
                                for="info">Update My Information</label>
                            <input type="checkbox" id="portfolio" name="type" value="portfolio"><label
                                for="portfolio">Add My Artworks</label>
                            <input type="checkbox" id="Other" name="Other" value="Other"><label
                                for="Other">Other</label>
                            <div class="other-input"><input type="text" id="other_text" name="other_text"
                                    placeholder="Please specify... *"></div>
                        </div>
                    </div>

                    <textarea name="description" id="description" placeholder="Describe your request. (Include all relevant details). *"
                        required></textarea>
                </div>

                <div class="btn-group">
                    <button type="button" onclick="prevStep(2)" class="long-btn">Previous</button>
                    <button type="button" onclick="nextStep(2)" class="long-btn">Next</button>
                </div>
            </div>

        
            <div class="form-step" id="step3">
                <div class="inputs">
                    <p>Attach a link (if any):</p>
                    <input type="text" id="link" name="link" placeholder="Attach a link" />
                    <p>Attach a file (if any):</p>
                    <input type="file" id="file" name="file" placeholder="Attach a file" />
                </div>
                <div class="btn-group">
                    <button type="button" onclick="prevStep(3)" class="long-btn">Previous</button>
                    <button type="submit" onclick="validateStep(3)" class="long-btn" id="request">Request</button>
                </div>
            </div>
        </form>
    </section>
    <script src="../scripts/common.js"></script>
    <script src="../scripts/authentication.js"></script>
    <script>
        let currentStep = 1;

        function showStep(step) {
            document.querySelectorAll(".form-step").forEach((el, i) => {
                el.classList.remove("active");
                if (i === step - 1) el.classList.add("active");
            });
            currentStep = step;
        }

        function validateStep(step) {
            let valid = true;

            if (step === 1) {
                ["name", "email", "phone"].forEach(id => {
                    if (!document.getElementById(id).value.trim()) valid = false;
                });
                if (!document.getElementById("position").value) valid = false;
            }

            if (step === 2) {
                if (document.querySelectorAll("input[name='type']:checked").length === 0) valid = false;
                ["description"].forEach(id => {
                    if (!document.getElementById(id).value.trim()) valid = false;
                });
            }

            if (!valid) showAlert("⚠️", "Please fill all required fields before continuing.", [{ text: "OK" }]);
            return valid;
        }

        function nextStep(step) {
            if (validateStep(step)) {
                showStep(step + 1);
            }
        }

        function prevStep(step) {
            showStep(step - 1);
        }
        async function handleFormSubmit(e) {
            e.preventDefault();
            const url = "https://script.google.com/macros/s/AKfycbzOQzwj7qcwvdJhgKkQtjItYx6ZfyX3BVw48TnvkS6t8tQA4uWRIrsg-Izp7xJkcQ61/exec";
            const form = document.getElementById("templateForm");
            const formData = new FormData(form);

            try {
                const response = await fetch(url, { method: "POST", body: formData });
                const json = await response.json();

                if (json.result === "success") {
                    showAlert("Request Sent!", "Your request has been submitted successfully and will be reviewed shortly.", [{ text: "OK" }]);
                    confetti();
                    form.reset();
                    showStep(1);
                } else {
                    showAlert("⚠️", json.message, [{ text: "OK" }]);
                }
            } catch (err) {
                console.error(err);
                showAlert("❌ Something went wrong!", "Please try again later.", [{ text: "OK" }]);
            }
        }

        (function () {
            function rand(min, max) { return Math.random() * (max - min) + min; }

            const COLORS = [
                "#ff004f", "#ff7a00", "#ffd400", "#00e676", "#00b0ff", "#7c4dff",
                "#ff1744", "#ffea00", "#00e5ff", "#69f0ae", "#b388ff", "#ff80ab"
            ];

            // Public API
            window.confetti = function confetti(opts = {}) {
                const {
                    particleCount = 220,
                    scalar = 1,
                    gravity = 0.33,
                    drift = 0.03,
                    decay = 0.007,     // higher = faster fade
                    spread = 70,       // degrees
                    angle = -90,       // -90 = straight up
                    origin = { x: 0.5, y: 0.7 }, // normalized viewport
                    shapes = ["square", "circle", "triangle"]
                } = opts;

                // Canvas setup
                const dpr = Math.min(window.devicePixelRatio || 1, 2);
                const canvas = document.createElement("canvas");
                const ctx = canvas.getContext("2d");
                canvas.style.cssText = "position:fixed;inset:0;pointer-events:none;z-index:999999";
                document.body.appendChild(canvas);

                function resize() {
                    canvas.width = innerWidth * dpr;
                    canvas.height = innerHeight * dpr;
                    ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
                }
                resize();
                addEventListener("resize", resize);

                // Particle factory
                const angleRad = (angle * Math.PI) / 180;
                const spreadRad = (spread * Math.PI) / 180;
                const ox = innerWidth * origin.x;
                const oy = innerHeight * origin.y;

                const particles = [];
                for (let i = 0; i < particleCount; i++) {
                    const t = angleRad + rand(-spreadRad / 2, spreadRad / 2);
                    const speed = rand(6, 12) * scalar;
                    particles.push({
                        x: ox, y: oy,
                        vx: Math.cos(t) * speed + rand(-1, 1),
                        vy: Math.sin(t) * speed + rand(-1, 1),
                        w: rand(6, 12) * scalar,
                        h: rand(6, 12) * scalar,
                        r: rand(0, Math.PI * 2),
                        rv: rand(-0.2, 0.2),
                        color: COLORS[(Math.random() * COLORS.length) | 0],
                        shape: shapes[(Math.random() * shapes.length) | 0],
                        alpha: 1,
                        life: rand(220, 340)
                    });
                }

                let raf;
                function drawShape(p) {
                    ctx.fillStyle = p.color;
                    switch (p.shape) {
                        case "circle":
                            ctx.beginPath();
                            ctx.arc(p.x, p.y, p.w * 0.6, 0, Math.PI * 2);
                            ctx.fill();
                            break;
                        case "triangle":
                            ctx.beginPath();
                            ctx.moveTo(p.x + Math.cos(p.r) * p.w, p.y + Math.sin(p.r) * p.h);
                            ctx.lineTo(p.x + Math.cos(p.r + 2.09) * p.w, p.y + Math.sin(p.r + 2.09) * p.h);
                            ctx.lineTo(p.x + Math.cos(p.r + 4.18) * p.w, p.y + Math.sin(p.r + 4.18) * p.h);
                            ctx.closePath();
                            ctx.fill();
                            break;
                        default: // square/rect
                            ctx.save();
                            ctx.translate(p.x, p.y);
                            ctx.rotate(p.r);
                            ctx.fillRect(-p.w / 2, -p.h / 2, p.w, p.h);
                            ctx.restore();
                    }
                }

                function frame() {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    let alive = 0;

                    for (const p of particles) {
                        p.x += p.vx + drift * (Math.random() - 0.5) * 20;
                        p.y += p.vy += gravity; // gravity accelerates downward
                        p.r += p.rv;
                        p.life--;
                        p.alpha = Math.max(0, p.alpha - decay);

                        if (p.alpha > 0 && p.life > 0 && p.y < innerHeight + 40) {
                            ctx.globalAlpha = p.alpha;
                            drawShape(p);
                            ctx.globalAlpha = 1;
                            alive++;
                        }
                    }

                    if (alive > 0) {
                        raf = requestAnimationFrame(frame);
                    } else {
                        cleanup();
                    }
                }

                function cleanup() {
                    cancelAnimationFrame(raf);
                    removeEventListener("resize", resize);
                    canvas.remove();
                }

                raf = requestAnimationFrame(frame);

                // Return a tiny controller in case you want to kill early
                return { stop: cleanup, canvas };
            };
        })();

    </script>
</body>




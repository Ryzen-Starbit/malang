<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="resrc/images/icons/favicon.png" type="image/x-icon">
    <link rel="stylesheet" href="src/styles/common.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#111111">
    <link rel="apple-touch-icon" href="/resrc/images/icons/malang.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Malang</title>
</head>

<body>
    <div data-include="/src/components/nav.html"></div>
    <iframe style="border: none; position: fixed; top:0px; left:0; width: 100vw; height: 100vh; overflow-x: auto;"
        id="content"></iframe>
    <script src="src/scripts/common.js"></script>
    <script src="src/scripts/load.js"></script>
    <script type="module" src="https://cdn.jsdelivr.net/npm/ldrs/dist/auto/lineWobble.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyD20pmHMSjDirK1CFEz1EIrUJWwqbVLev4",
            authDomain: "malang-auth.firebaseapp.com",
            projectId: "malang-auth",
            storageBucket: "malang-auth.firebasestorage.app",
            messagingSenderId: "522245850115",
            appId: "1:522245850115:web:f8a69e1e021222fa997a36",
            measurementId: "G-GHFQ1YG8WZ"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        // Load allowed emails once
        let allowedEmails = [];
        fetch("/resrc/data/member-emails.json")
            .then(res => res.json())
            .then(data => allowedEmails = data);

        // Update navbar profile picture
        function updateNavbar(user) {
            const profilePic = document.getElementById("profilePic");
            if (user && allowedEmails.includes(user.email)) {
                profilePic.src = user.photoURL || "/resrc/images/icons/user.png";
                profilePic.classList.add("profile-pic");
                localStorage.setItem("loggedIn", "true");
            } else {
                profilePic.src = "/resrc/images/icons/user.png";
                profilePic.classList.remove("profile-pic");
                localStorage.setItem("loggedIn", "false");
            }
        }

        // Keep navbar always synced
        onAuthStateChanged(auth, updateNavbar);

        // Expose auth to iframes
        window.firebaseAuth = auth;

        const iframe = document.querySelector("#content");
        iframe.addEventListener("wheel", (e) => {
            iframe.contentWindow.dispatchEvent(new WheelEvent("wheel", e));
        });

    </script>

    <!-- Link your JS -->
    <script src="/src/scripts/search.js"></script>
    <!-- Include Fuse.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>
</body>

</html>